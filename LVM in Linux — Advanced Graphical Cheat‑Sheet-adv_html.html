<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LVM in Linux — Advanced Graphical Cheat‑Sheet</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f172a;          /* slate-900 */
      --panel-2:#111827;        /* gray-900 */
      --ink:#e5e7eb;            /* gray-200 */
      --muted:#9ca3af;          /* gray-400 */
      --primary:#60a5fa;        /* blue-400 */
      --accent:#22d3ee;         /* cyan-400 */
      --ok:#34d399;             /* emerald-400 */
      --warn:#fbbf24;           /* amber-400 */
      --danger:#f87171;         /* red-400 */
      --violet:#a78bfa;         /* violet-400 */
      --rose:#fb7185;           /* rose-400 */
      --surface:#0b1020;
      --border: rgba(148,163,184,.28);
      --shadow: 0 8px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
    }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #172554 0%, transparent 60%),
                  radial-gradient(1000px 600px at 120% 10%, #0e7490 0%, transparent 50%),
                  var(--bg);
      color: var(--ink);
      line-height:1.4;
    }
    .wrap{ max-width:1120px; margin:40px auto 96px; padding:0 20px; }
    header{ text-align:center; margin-bottom:28px; }
    h1{ font-size: clamp(28px, 4vw, 48px); letter-spacing:.2px; margin:6px 0 12px; }
    .subtitle{ color: var(--muted); font-size: 14px; }
    section{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
             border:1px solid var(--border); border-radius:20px; padding:18px 18px 14px; box-shadow:var(--shadow); margin:18px 0 26px; }
    h2{ font-size: clamp(18px, 2.8vw, 26px); margin:6px 0 14px; }
    .row{ display:grid; grid-template-columns: 1.2fr .8fr; gap:14px; }
    .row-2{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    .legend{ display:flex; flex-wrap:wrap; gap:10px; font-size:12px; color:var(--muted); margin-top:8px }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:rgba(255,255,255,.02); }
    .dot{ width:10px; height:10px; border-radius:99px; background:var(--ink); box-shadow:inset 0 0 0 1px rgba(255,255,255,.35); }

    .note{ font-size:12px; color:var(--muted); margin-top:6px }
    .code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:12.5px; background: #0b1020; border:1px dashed var(--border); padding:10px 12px; border-radius:12px; }
    .grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:14px; }

    /* SVG helpers */
    svg{ width:100%; height:auto; display:block; }
    .blk{ fill:#111827; stroke: rgba(148,163,184,.35); }
    .label{ fill:#e5e7eb; font-size:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"; }
    .muted{ fill:#9ca3af; }
    .cap{ font-size:11px; fill:#9ca3af }
    .t-primary{ fill: var(--primary) }
    .t-accent{ fill: var(--accent) }
    .t-ok{ fill: var(--ok) }
    .t-warn{ fill: var(--warn) }
    .t-violet{ fill: var(--violet) }
    .t-rose{ fill: var(--rose) }

    .tag{ font-size:10px; fill:#0b1020; }
    .badge{ fill: rgba(255,255,255,.85); stroke: rgba(255,255,255,.6) }

    @media (max-width: 920px){ .row, .row-2{ grid-template-columns: 1fr; } }
    @media print{ body{ background:#fff; } section{ break-inside: avoid; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>LVM in Linux — Advanced Graphical Cheat‑Sheet</h1>
      <div class="subtitle">Physical Volumes → Volume Groups → Logical Volumes · Extents · Snapshots · Thin Provisioning · RAID · Encryption · Performance & Layouts</div>
    </header>

    <!-- 1) Stack Overview -->
    <section>
      <h2>1) High‑Level Stack & Common Layers</h2>
      <div class="row">
        <div>
          <svg viewBox="0 0 880 360" aria-label="LVM layer cake">
            <!-- Disks / MD / LUKS / PV / VG / LV / FS -->
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#0ea5e9" stop-opacity=".35" />
                <stop offset="1" stop-color="#6366f1" stop-opacity=".35" />
              </linearGradient>
            </defs>

            <!-- Physical Devices -->
            <rect x="20" y="280" width="240" height="56" rx="12" class="blk" fill="url(#g1)"/>
            <text x="140" y="312" text-anchor="middle" class="label">/dev/sda · /dev/sdb · NVMe</text>
            <text x="140" y="328" text-anchor="middle" class="cap">Physical devices</text>

            <!-- MD RAID (optional) -->
            <rect x="300" y="280" width="240" height="56" rx="12" class="blk"/>
            <text x="420" y="312" text-anchor="middle" class="label">mdadm /dev/md0 (RAID0/1/5/10)</text>
            <text x="420" y="328" text-anchor="middle" class="cap">Software RAID</text>

            <!-- LUKS (optional) -->
            <rect x="580" y="280" width="280" height="56" rx="12" class="blk"/>
            <text x="720" y="310" text-anchor="middle" class="label">LUKS container /dev/mapper/cryptX</text>
            <text x="720" y="328" text-anchor="middle" class="cap">dm-crypt</text>

            <!-- PV layer -->
            <rect x="20" y="208" width="840" height="52" rx="12" class="blk"/>
            <text x="440" y="238" text-anchor="middle" class="label">LVM Physical Volumes (PV)</text>

            <!-- VG layer -->
            <rect x="20" y="140" width="840" height="52" rx="12" class="blk"/>
            <text x="440" y="170" text-anchor="middle" class="label">Volume Group (VG) — pool of extents</text>

            <!-- LV layer -->
            <rect x="20" y="72" width="840" height="52" rx="12" class="blk"/>
            <text x="440" y="102" text-anchor="middle" class="label">Logical Volumes (LV) — linear / striped / mirrored / thin</text>

            <!-- Filesystem / Application -->
            <rect x="20" y="16" width="420" height="40" rx="10" class="blk"/>
            <text x="230" y="40" text-anchor="middle" class="label">Filesystem (ext4/xfs) or raw (db)</text>

            <rect x="460" y="16" width="400" height="40" rx="10" class="blk"/>
            <text x="660" y="40" text-anchor="middle" class="label">Swap · Containers · KVM images · Databases</text>

            <!-- arrows -->
            <g class="muted">
              <path d="M440,56 v16" stroke="currentColor"/>
              <path d="M440,124 v16" stroke="currentColor"/>
              <path d="M440,192 v16" stroke="currentColor"/>
              <path d="M440,260 v16" stroke="currentColor"/>
            </g>
          </svg>
        </div>
        <div>
          <div class="code">
# Typical layering (secure, resilient)
$ mdadm --create /dev/md0 -l1 -n2 /dev/sda /dev/sdb
$ cryptsetup luksFormat /dev/md0
$ cryptsetup open /dev/md0 cryptdata
$ pvcreate /dev/mapper/cryptdata
$ vgcreate vgdata /dev/mapper/cryptdata
$ lvcreate -L 200G -n lv_app vgdata
$ mkfs.xfs /dev/vgdata/lv_app
$ mount /dev/vgdata/lv_app /srv/app
          </div>
          <div class="legend">
            <span class="pill"><span class="dot" style="background:var(--primary)"></span>RAID / Perf</span>
            <span class="pill"><span class="dot" style="background:var(--accent)"></span>Security (LUKS)</span>
            <span class="pill"><span class="dot" style="background:var(--ok)"></span>Capacity Pool (VG)</span>
            <span class="pill"><span class="dot" style="background:var(--warn)"></span>Layouts (LV)</span>
          </div>
          <p class="note">Best practice: If you need both encryption and redundancy, put LVM <em>inside</em> LUKS atop RAID so all LVs are encrypted. Alternatively, encrypt per‑LV with <code>cryptsetup</code> if keys/policies differ.</p>
        </div>
      </div>
    </section>

    <!-- 2) PE/LE mapping & allocation -->
    <section>
      <h2>2) Extents: PE ⇄ LE Mapping & Allocation</h2>
      <div class="row-2">
        <div>
          <svg viewBox="0 0 820 310">
            <!-- PVs with PEs -->
            <rect x="20" y="34" width="240" height="240" rx="16" class="blk"/>
            <text x="140" y="24" text-anchor="middle" class="t-ok label">PV /dev/sda2</text>

            <rect x="290" y="34" width="240" height="240" rx="16" class="blk"/>
            <text x="410" y="24" text-anchor="middle" class="t-ok label">PV /dev/sdb2</text>

            <rect x="560" y="34" width="240" height="240" rx="16" class="blk"/>
            <text x="680" y="24" text-anchor="middle" class="t-ok label">PV /dev/nvme0n1p3</text>

            <!-- draw extents as small boxes -->
            <g>
              <!-- functionally just a pattern of boxes; colors denote allocation to LVs -->
              <g id="pegrid">
                <!-- We'll manually place a few to suggest pattern -->
              </g>
              <!-- Generate rows manually (static) -->
              <g>
                <!-- PV1 rows -->
                <g fill="#1f2937" stroke="rgba(148,163,184,.3)">
                  <!-- 6x5 grid -->
                  <g>
                    <rect x="36" y="56" width="28" height="28" rx="4"/>
                    <rect x="68" y="56" width="28" height="28" rx="4" fill="#1e293b"/>
                    <rect x="100" y="56" width="28" height="28" rx="4" fill="#1e293b"/>
                    <rect x="132" y="56" width="28" height="28" rx="4" fill="#0f766e"/>
                    <rect x="164" y="56" width="28" height="28" rx="4" fill="#0f766e"/>
                    <rect x="196" y="56" width="28" height="28" rx="4" fill="#0ea5e9"/>
                  </g>
                  <g>
                    <rect x="36" y="88" width="28" height="28" rx="4"/>
                    <rect x="68" y="88" width="28" height="28" rx="4"/>
                    <rect x="100" y="88" width="28" height="28" rx="4" fill="#0ea5e9"/>
                    <rect x="132" y="88" width="28" height="28" rx="4" fill="#0ea5e9"/>
                    <rect x="164" y="88" width="28" height="28" rx="4"/>
                    <rect x="196" y="88" width="28" height="28" rx="4" fill="#a78bfa"/>
                  </g>
                  <g>
                    <rect x="36" y="120" width="28" height="28" rx="4"/>
                    <rect x="68" y="120" width="28" height="28" rx="4" fill="#a78bfa"/>
                    <rect x="100" y="120" width="28" height="28" rx="4"/>
                    <rect x="132" y="120" width="28" height="28" rx="4"/>
                    <rect x="164" y="120" width="28" height="28" rx="4" fill="#34d399"/>
                    <rect x="196" y="120" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="36" y="152" width="28" height="28" rx="4" fill="#34d399"/>
                    <rect x="68" y="152" width="28" height="28" rx="4"/>
                    <rect x="100" y="152" width="28" height="28" rx="4"/>
                    <rect x="132" y="152" width="28" height="28" rx="4"/>
                    <rect x="164" y="152" width="28" height="28" rx="4" fill="#fb7185"/>
                    <rect x="196" y="152" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="36" y="184" width="28" height="28" rx="4"/>
                    <rect x="68" y="184" width="28" height="28" rx="4" fill="#fb7185"/>
                    <rect x="100" y="184" width="28" height="28" rx="4"/>
                    <rect x="132" y="184" width="28" height="28" rx="4"/>
                    <rect x="164" y="184" width="28" height="28" rx="4"/>
                    <rect x="196" y="184" width="28" height="28" rx="4"/>
                  </g>
                </g>

                <!-- PV2 grid (different pattern) -->
                <g fill="#1f2937" stroke="rgba(148,163,184,.3)">
                  <g>
                    <rect x="306" y="56" width="28" height="28" rx="4" fill="#a78bfa"/>
                    <rect x="338" y="56" width="28" height="28" rx="4"/>
                    <rect x="370" y="56" width="28" height="28" rx="4" fill="#0ea5e9"/>
                    <rect x="402" y="56" width="28" height="28" rx="4"/>
                    <rect x="434" y="56" width="28" height="28" rx="4"/>
                    <rect x="466" y="56" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="306" y="88" width="28" height="28" rx="4"/>
                    <rect x="338" y="88" width="28" height="28" rx="4" fill="#34d399"/>
                    <rect x="370" y="88" width="28" height="28" rx="4"/>
                    <rect x="402" y="88" width="28" height="28" rx="4"/>
                    <rect x="434" y="88" width="28" height="28" rx="4" fill="#fb7185"/>
                    <rect x="466" y="88" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="306" y="120" width="28" height="28" rx="4"/>
                    <rect x="338" y="120" width="28" height="28" rx="4"/>
                    <rect x="370" y="120" width="28" height="28" rx="4"/>
                    <rect x="402" y="120" width="28" height="28" rx="4" fill="#0ea5e9"/>
                    <rect x="434" y="120" width="28" height="28" rx="4"/>
                    <rect x="466" y="120" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="306" y="152" width="28" height="28" rx="4"/>
                    <rect x="338" y="152" width="28" height="28" rx="4"/>
                    <rect x="370" y="152" width="28" height="28" rx="4"/>
                    <rect x="402" y="152" width="28" height="28" rx="4"/>
                    <rect x="434" y="152" width="28" height="28" rx="4"/>
                    <rect x="466" y="152" width="28" height="28" rx="4" fill="#a78bfa"/>
                  </g>
                  <g>
                    <rect x="306" y="184" width="28" height="28" rx="4"/>
                    <rect x="338" y="184" width="28" height="28" rx="4"/>
                    <rect x="370" y="184" width="28" height="28" rx="4"/>
                    <rect x="402" y="184" width="28" height="28" rx="4"/>
                    <rect x="434" y="184" width="28" height="28" rx="4"/>
                    <rect x="466" y="184" width="28" height="28" rx="4"/>
                  </g>
                </g>

                <!-- PV3 grid -->
                <g fill="#1f2937" stroke="rgba(148,163,184,.3)">
                  <g>
                    <rect x="576" y="56" width="28" height="28" rx="4" fill="#0ea5e9"/>
                    <rect x="608" y="56" width="28" height="28" rx="4"/>
                    <rect x="640" y="56" width="28" height="28" rx="4"/>
                    <rect x="672" y="56" width="28" height="28" rx="4" fill="#34d399"/>
                    <rect x="704" y="56" width="28" height="28" rx="4"/>
                    <rect x="736" y="56" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="576" y="88" width="28" height="28" rx="4"/>
                    <rect x="608" y="88" width="28" height="28" rx="4" fill="#34d399"/>
                    <rect x="640" y="88" width="28" height="28" rx="4"/>
                    <rect x="672" y="88" width="28" height="28" rx="4"/>
                    <rect x="704" y="88" width="28" height="28" rx="4"/>
                    <rect x="736" y="88" width="28" height="28" rx="4" fill="#fb7185"/>
                  </g>
                  <g>
                    <rect x="576" y="120" width="28" height="28" rx="4"/>
                    <rect x="608" y="120" width="28" height="28" rx="4"/>
                    <rect x="640" y="120" width="28" height="28" rx="4"/>
                    <rect x="672" y="120" width="28" height="28" rx="4"/>
                    <rect x="704" y="120" width="28" height="28" rx="4" fill="#a78bfa"/>
                    <rect x="736" y="120" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="576" y="152" width="28" height="28" rx="4"/>
                    <rect x="608" y="152" width="28" height="28" rx="4"/>
                    <rect x="640" y="152" width="28" height="28" rx="4"/>
                    <rect x="672" y="152" width="28" height="28" rx="4"/>
                    <rect x="704" y="152" width="28" height="28" rx="4"/>
                    <rect x="736" y="152" width="28" height="28" rx="4"/>
                  </g>
                  <g>
                    <rect x="576" y="184" width="28" height="28" rx="4"/>
                    <rect x="608" y="184" width="28" height="28" rx="4"/>
                    <rect x="640" y="184" width="28" height="28" rx="4"/>
                    <rect x="672" y="184" width="28" height="28" rx="4"/>
                    <rect x="704" y="184" width="28" height="28" rx="4"/>
                    <rect x="736" y="184" width="28" height="28" rx="4"/>
                  </g>
                </g>
              </g>

              <text x="140" y="284" text-anchor="middle" class="cap">Each square = one Physical Extent (PE)</text>
              <text x="410" y="284" text-anchor="middle" class="cap">PE size (vgcreate): commonly 4 MiB, 8 MiB, …</text>
              <text x="680" y="284" text-anchor="middle" class="cap">LE ≡ PE in size; LV capacity = #LE × extent_size</text>
            </g>
          </svg>
        </div>
        <div>
          <div class="code">
# Inspecting extents & mappings
$ vgdisplay -v vgdata | grep -i "PE Size"
$ pvs -o +pv_used,pv_pe_count,pv_pe_alloc_count
$ lvdisplay -m /dev/vgdata/lv_app    # LE → PE mapping
$ lvextend -l +100%FREE /dev/vgdata/lv_app
$ resize2fs /dev/vgdata/lv_app       # or xfs_growfs /mount
          </div>
          <ul style="margin-top:10px; color:var(--muted); line-height:1.5">
            <li><strong>Extent size</strong> chosen at <code>vgcreate</code> affects max LV size & metadata overhead. Larger extents ⟶ fewer metadata updates but coarser allocation.</li>
            <li><strong>PVs add capacity</strong> to a VG; LVs consume extents linearly, striped, or mirrored/RAID via <code>lvcreate -i/-m</code> or <code>--type raidX</code>.</li>
            <li><strong>Online growth</strong>: extend LV then grow filesystem; shrink requires FS‑aware steps and is riskier (avoid on XFS).</li>
          </ul>
          <div class="legend">
            <span class="pill"><span class="dot" style="background:#0ea5e9"></span>LV: data</span>
            <span class="pill"><span class="dot" style="background:#a78bfa"></span>LV: logs</span>
            <span class="pill"><span class="dot" style="background:#34d399"></span>LV: DB index</span>
            <span class="pill"><span class="dot" style="background:#fb7185"></span>Free/Unallocated</span>
          </div>
        </div>
      </div>
    </section>

    <!-- 3) LV layouts -->
    <section>
      <h2>3) Logical Volume Layouts (Performance & Redundancy)</h2>
      <div class="grid">
        <!-- Linear -->
        <div>
          <h3 style="margin:6px 0 8px">Linear</h3>
          <svg viewBox="0 0 340 160">
            <rect x="16" y="24" width="308" height="36" rx="10" class="blk"/>
            <text x="170" y="46" text-anchor="middle" class="label">LV linear (extents in order)</text>
            <rect x="24" y="74" width="140" height="24" rx="6" class="blk" fill="#0ea5e9"/>
            <rect x="168" y="74" width="140" height="24" rx="6" class="blk" fill="#0ea5e9"/>
            <text x="170" y="120" text-anchor="middle" class="cap">Pros: simple; good for growth. Cons: bound by a single PV's perf at a time.</text>
          </svg>
          <div class="code">$ lvcreate -L 200G -n lv_lin vg</div>
        </div>
        <!-- Striped -->
        <div>
          <h3 style="margin:6px 0 8px">Striped (RAID0‑like)</h3>
          <svg viewBox="0 0 340 160">
            <rect x="16" y="24" width="308" height="36" rx="10" class="blk"/>
            <text x="170" y="46" text-anchor="middle" class="label">LV striped across PVs</text>
            
            <!-- stripes -->
            <rect x="24" y="74" width="40" height="24" rx="4" class="blk" fill="#22d3ee"/>
            <rect x="68" y="74" width="40" height="24" rx="4" class="blk" fill="#60a5fa"/>
            <rect x="112" y="74" width="40" height="24" rx="4" class="blk" fill="#22d3ee"/>
            <rect x="156" y="74" width="40" height="24" rx="4" class="blk" fill="#60a5fa"/>
            <rect x="200" y="74" width="40" height="24" rx="4" class="blk" fill="#22d3ee"/>
            <rect x="244" y="74" width="40" height="24" rx="4" class="blk" fill="#60a5fa"/>
            <rect x="288" y="74" width="28" height="24" rx="4" class="blk" fill="#22d3ee"/>

            <text x="170" y="120" text-anchor="middle" class="cap">Pros: throughput & IOPS. Cons: any PV loss breaks LV.</text>
          </svg>
          <div class="code">$ lvcreate -i2 -I 64 -L 200G -n lv_striped vg</div>
        </div>
        <!-- Mirrored/RAID1 -->
        <div>
          <h3 style="margin:6px 0 8px">Mirrored / RAID1</h3>
          <svg viewBox="0 0 340 160">
            <rect x="16" y="24" width="308" height="36" rx="10" class="blk"/>
            <text x="170" y="46" text-anchor="middle" class="label">LV with 1 mirror</text>

            <rect x="24" y="74" width="140" height="24" rx="6" class="blk" fill="#a78bfa"/>
            <rect x="168" y="74" width="140" height="24" rx="6" class="blk" fill="#a78bfa"/>

            <text x="170" y="120" text-anchor="middle" class="cap">Pros: redundancy; read scaling. Cons: 2× space; write cost.</text>
          </svg>
          <div class="code">$ lvcreate -m 1 -L 200G -n lv_mirror vg</div>
        </div>
      </div>
      <div class="note">For parity (RAID5/6) use <code>lvcreate --type raid5|raid6</code>. Prefer MD RAID for complex arrays on older userspace; modern LVM RAID is solid for many workloads.</div>
    </section>

    <!-- 4) Snapshots ( CoW ) -->
    <section>
      <h2>4) Snapshots (Copy‑on‑Write)</h2>
      <div class="row-2">
        <div>
          <svg viewBox="0 0 820 220">
            <rect x="24" y="24" width="360" height="44" rx="10" class="blk"/>
            <text x="204" y="50" text-anchor="middle" class="label">Origin LV</text>

            <rect x="24" y="80" width="360" height="28" rx="8" class="blk" fill="#22d3ee"/>
            <text x="204" y="98" text-anchor="middle" class="cap">Data blocks at t0</text>

            <rect x="420" y="24" width="360" height="44" rx="10" class="blk"/>
            <text x="600" y="50" text-anchor="middle" class="label">Snapshot LV (CoW store)</text>

            <rect x="420" y="80" width="360" height="28" rx="8" class="blk" fill="#a78bfa"/>
            <text x="600" y="98" text-anchor="middle" class="cap">Changed blocks copied here</text>

            <!-- arrows / write -->
            <g class="muted">
              <path d="M384,94 h24" stroke="currentColor"/>
              <path d="M600,124 v20" stroke="currentColor"/>
            </g>

            <rect x="240" y="140" width="160" height="26" rx="7" class="blk" fill="#34d399"/>
            <text x="320" y="158" text-anchor="middle" class="cap">Write to origin</text>

            <rect x="500" y="140" width="200" height="26" rx="7" class="blk" fill="#fb7185"/>
            <text x="600" y="158" text-anchor="middle" class="cap">Copy old block → snapshot</text>
          </svg>
        </div>
        <div>
          <div class="code">
# Classic snapshot (reserve CoW space)
$ lvcreate -s -L 20G -n lv_app_snap /dev/vgdata/lv_app
# Restore by merging (offline for origin)
$ lvconvert --merge /dev/vgdata/lv_app_snap
          </div>
          <ul style="margin-top:8px; color:var(--muted)">
            <li>Snapshot fills as writes occur to origin; if CoW LV fills up, snapshot becomes invalid.</li>
            <li>Use for backups, short‑term testing, or pre‑upgrade safety net.</li>
            <li>For many/long‑lived snaps, prefer <strong>thin</strong> snapshots.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 5) Thin provisioning -->
    <section>
      <h2>5) Thin Provisioning (Thin Pool & Thin LVs)</h2>
      <div class="row-2">
        <div>
          <svg viewBox="0 0 820 240">
            <rect x="24" y="20" width="772" height="40" rx="10" class="blk"/>
            <text x="410" y="46" text-anchor="middle" class="label">Thin Pool (data + metadata)</text>

            <!-- data/metadata slices -->
            <rect x="40" y="76" width="600" height="28" rx="6" class="blk" fill="#60a5fa"/>
            <text x="340" y="95" text-anchor="middle" class="cap">Data device</text>
            <rect x="648" y="76" width="132" height="28" rx="6" class="blk" fill="#22d3ee"/>
            <text x="714" y="95" text-anchor="middle" class="cap">Metadata</text>

            <!-- consumer thin LVs -->
            <rect x="24" y="130" width="240" height="32" rx="8" class="blk"/>
            <text x="144" y="150" text-anchor="middle" class="cap">thinlv_app (1TB virtual)</text>

            <rect x="288" y="130" width="240" height="32" rx="8" class="blk"/>
            <text x="408" y="150" text-anchor="middle" class="cap">thinlv_logs (200G virtual)</text>

            <rect x="552" y="130" width="244" height="32" rx="8" class="blk"/>
            <text x="674" y="150" text-anchor="middle" class="cap">thinlv_ci (50G virtual)</text>

            <text x="410" y="196" text-anchor="middle" class="cap">Blocks are allocated on demand. Monitor pool usage & metadata!</text>
          </svg>
        </div>
        <div>
          <div class="code">
# Create thin pool
$ lvcreate -L 900G -T vg/thinpool -V 2T
# Create thin volumes (virtual size)
$ lvcreate -V 1T -T vg/thinpool -n thinlv_app
$ lvcreate -V 200G -T vg/thinpool -n thinlv_logs
# Snapshot a thin LV (cheap)
$ lvcreate -s -n snap_app vg/thinpool/thinlv_app
# Monitor & extend
$ lvs -a -o+seg_monitor,metadata_percent,data_percent
$ lvextend -L +200G vg/thinpool
          </div>
          <ul style="margin-top:8px; color:var(--muted)">
            <li>Set up <strong>activation/thin_pool_autoextend_threshold</strong> and <strong>_percent</strong> in <code>lvm.conf</code> or use monitoring to avoid <em>out‑of‑space</em>.</li>
            <li>Thin metadata corruption is catastrophic—keep backups (<code>lvconvert --repair</code> exists but is last resort).</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 6) Data movement & maintenance -->
    <section>
      <h2>6) Data Movement, Resizing & Maintenance</h2>
      <div class="row-2">
        <div>
          <svg viewBox="0 0 820 240">
            <!-- pvmove -->
            <rect x="24" y="16" width="772" height="40" rx="10" class="blk"/>
            <text x="410" y="42" text-anchor="middle" class="label">pvmove — migrate extents off a PV live</text>

            <rect x="40" y="70" width="320" height="28" rx="6" class="blk" fill="#60a5fa"/>
            <text x="200" y="88" text-anchor="middle" class="cap">Source PV (/dev/sdb2)</text>

            <rect x="460" y="70" width="320" height="28" rx="6" class="blk" fill="#34d399"/>
            <text x="620" y="88" text-anchor="middle" class="cap">Dest PV (/dev/nvme0n1p3)</text>

            <path d="M372,84 h72" stroke="#e5e7eb" stroke-dasharray="4 4"/>
            <polygon points="444,80 444,88 452,84" fill="#e5e7eb"/>

            <!-- resize flow -->
            <rect x="24" y="128" width="772" height="40" rx="10" class="blk"/>
            <text x="410" y="154" text-anchor="middle" class="label">Resizing flow</text>
            <text x="160" y="196" text-anchor="middle" class="cap">1) lvextend</text>
            <text x="410" y="196" text-anchor="middle" class="cap">2) grow filesystem (xfs_growfs / resize2fs)</text>
            <text x="660" y="196" text-anchor="middle" class="cap">3) update fstab/monitoring</text>
          </svg>
        </div>
        <div>
          <div class="code">
# Move data off a failing/slow disk
$ pvmove /dev/sdb2 /dev/nvme0n1p3
# Restrict to one LV
$ pvmove -n lv_app /dev/sdb2 /dev/nvme0n1p3
# Remove a PV from the VG after evacuating
$ vgreduce vgdata /dev/sdb2 && pvremove /dev/sdb2

# Grow LV & filesystem online
$ lvextend -r -L +200G /dev/vgdata/lv_app  # -r runs FS grow if supported
          </div>
          <ul style="margin-top:8px; color:var(--muted)">
            <li>Keep <code>lvm2-monitor</code> active for auto‑repair of RAID LVs and thin pool auto‑extend.</li>
            <li>Use <code>lvchange -ay/-an</code> to control activation (multi‑boot/cluster nodes).</li>
            <li>For XFS shrinking: not supported; create new smaller LV, migrate with <code>xfsdump|restore</code> or <code>rsync</code>.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 7) LVM RAID & Write cache -->
    <section>
      <h2>7) LVM RAID, Cache & Write‑back</h2>
      <div class="row-2">
        <div>
          <svg viewBox="0 0 820 240">
            <rect x="24" y="16" width="772" height="40" rx="10" class="blk"/>
            <text x="410" y="42" text-anchor="middle" class="label">Hybrid: SSD cache in front of HDD LV</text>

            <rect x="40" y="72" width="360" height="36" rx="8" class="blk" fill="#0ea5e9"/>
            <text x="220" y="96" text-anchor="middle" class="cap">Data LV (on HDD PVs)</text>

            <rect x="420" y="72" width="176" height="36" rx="8" class="blk" fill="#a78bfa"/>
            <text x="508" y="96" text-anchor="middle" class="cap">Cache data</text>

            <rect x="604" y="72" width="176" height="36" rx="8" class="blk" fill="#22d3ee"/>
            <text x="692" y="96" text-anchor="middle" class="cap">Cache metadata</text>

            <text x="410" y="150" text-anchor="middle" class="cap">Modes: write‑through (safer), write‑back (faster, risk on cache loss)</text>
          </svg>
        </div>
        <div>
          <div class="code">
# Attach an SSD cache to an LV
$ lvcreate -n cachepool -L 64G vg ssd_pv --type cache-pool --poolmetadata mdcache
$ lvconvert --type cache --cachepool vg/cachepool vg/lv_hdd
# Switch cache mode
$ lvchange --cachesettings cache_mode=writeback vg/lv_hdd
          </div>
          <ul style="margin-top:8px; color:var(--muted)">
            <li>Cache failure in write‑back can corrupt data; ensure power‑loss protection.</li>
            <li>For parity RAID LVs, consider MD RAID unless you need LVM integration simplicity.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 8) Metadata, tags, and best practices -->
    <section>
      <h2>8) Metadata, Tags, Udev & Best Practices</h2>
      <div class="row-2">
        <div>
          <ul style="line-height:1.6">
            <li><strong>Metadata</strong>: stored at PV start (and possibly end). Keep backups: <code>vgcfgbackup</code>; restore via <code>vgcfgrestore</code>.</li>
            <li><strong>Device filters</strong>: in <code>/etc/lvm/lvm.conf</code> use <code>devices/filter</code> to ignore SAN paths or loop devices to avoid scan storms.</li>
            <li><strong>Names</strong>: use consistent naming with tags (e.g., <code>lvchange --addtag role=db</code>). Query: <code>lvs -S lv_tags~db</code>.</li>
            <li><strong>Alignment</strong>: ensure PE size is multiple of RAID stripe size / SSD erase block. Check <code>pvdisplay -m</code>.</li>
            <li><strong>Initramfs</strong>: when root on LVM, rebuild initramfs after changes to ensure activation at boot.</li>
            <li><strong>Backups & DR</strong>: prefer <em>thin snapshots + incremental backup</em> or <em>dm-integrity + RAID</em>. Test restores.</li>
            <li><strong>Clustered LVM</strong>: for shared VGs across nodes, use <code>lvmlockd</code> (sanlock/dlm). Not the same as filesystems' cluster semantics.</li>
          </ul>
        </div>
        <div>
          <div class="code">
# Back up and restore LVM metadata
$ vgcfgbackup
$ vgcfgrestore vgdata

# Tagging & selection
$ lvchange --addtag env=prod /dev/vgdata/lv_app
$ lvs -o lv_name,lv_tags,lv_size,lv_attr
$ lvs -S lv_tags~env=prod

# Device filter example (lvm.conf)
devices { filter = [ "a|/dev/sd[a-b]$|", "r|.*|" ] }
          </div>
        </div>
      </div>
    </section>

    <!-- 9) Quick reference commands -->
    <section>
      <h2>9) Quick Reference</h2>
      <div class="grid">
        <div class="code">
# Discover
$ lsblk -o NAME,TYPE,SIZE,FSTYPE,MOUNTPOINT
$ pvscan; vgscan; lvscan

# Create
$ pvcreate /dev/sdX
$ vgcreate vgname /dev/sdX /dev/sdY
$ lvcreate -L 50G -n lvname vgname

# Display
$ pvs; vgs; lvs -a -o+devices,segtype
$ lvdisplay -m /dev/vg/lv

# Resize
$ lvextend -L +100G /dev/vg/lv && xfs_growfs /mnt
$ lvreduce -L 200G /dev/vg/lv && resize2fs /dev/vg/lv  # (ext4 only; risky)
        </div>
        <div class="code">
# Snapshots
$ lvcreate -s -L 10G -n snap /dev/vg/lv
$ lvconvert --merge /dev/vg/snap

# Thin provisioning
$ lvcreate -L 500G -T vg/thinpool
$ lvcreate -V 2T -T vg/thinpool -n thinlv
$ lvs -a -o+data_percent,metadata_percent

# RAID / Cache
$ lvcreate --type raid1 -m1 -L 200G -n lv_mir vg
$ lvcreate --type raid5 -i3 -L 2T -n lv_r5 vg
$ lvconvert --type cache --cachepool vg/cachepool vg/lv
        </div>
        <div class="code">
# Move / Remove
$ pvmove /dev/sdb2 /dev/nvme0n1p3
$ vgreduce vg /dev/sdb2; pvremove /dev/sdb2

# Export/Import VG
$ vgexport vgdata; vgimport vgdata

# Health
$ lvs -a -o+devices,seg_monitor
$ dmesg | grep -i device-mapper
$ lvchange --refresh vg/lv
        </div>
      </div>
      <p class="note">This sheet focuses on modern <em>lvm2</em> features. Older mirror targets (<code>mirror</code>) are replaced by <code>raid1</code>; use <code>--type raidX</code> for parity.</p>
    </section>

    <footer style="text-align:center; color:var(--muted); font-size:12px; margin-top:22px">
      Non‑interactive single‑file HTML · Designed for print & screen · Colors: calm blue/cyan/violet accents.
    </footer>
  </div>
</body>
</html>
